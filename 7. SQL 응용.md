# 데이터베이스 기본
## 트랜잭션⭐
인가받지 않은 사용자로부터 데이터를 보장하기 위해 DBMS가 자겨야 하는 특성이자,   
DBMS에서 하나의 논리적 기능을 정상적으로 수행하기 위한 작업의 기본 단위이다.   

### 트랜잭션의 특성
1. 원자성(Atomicity)   
분해가 불가능한 작업의 최소 단위   
하나라도 실패할 경우 전체가 취소되는 특성   
2. 일관성(Consistency)   
트랜잭션 실행 성공 후 항상 일관된 데이터베이스 상태를 보존해야 하는 특성   
3. 격리성(Isolation)   
생성하는 연산의 중간 결과를 다른 트랜잭션이 접근 불가   
4. 영속성(Durability)   
성공이 완료된 트랜잭션의 결과는 영속적으로 DB에 저장하는 특성   

### 트랜잭션의 상태 변화
1. 활동 상태   
초기상태로 실행 중에 가지는 상태   
2. 부분 완료 상태   
마지막 명령문이 실행된 후 가지는 상태    
3. 완료 상태   
성공적으로 완료된 후 가지는 상태   
4. 실패 상태   
정상적인 실행이 더 이상 진행될 수 없을 때 가지는 상태   
5. 철회 상태   
트랜잭션이 취소되고 DB가 시작 전 상태로 환원된 상태   

### 트랜잭션 제어
TCL언어라고 하며, 트랜잭션 결과를 허용하거나 취소하는 목적으로 사용.   
1. 커밋(COMMIT)   
트랜잭션의 확정,메모리에 영구적으로 저장   
2. 롤백(ROLLBACK)   
트랜잭션의 취소, 저장 무효화시키는 명령어   
3. 체크포인트(CHECKPOINT)   
저장시기 설정, ROLLBACK을 위한 시점을 지정   

### 병행제어
다수 사용자 환경에서 여러 트랜잭션이 수행될때, DB의 일관성 유지를 위해 상호작용을 제어하는 기법.   
목적 = 공유를 최대화 & 활용을 최대화 & 일관성 유지 & 응답시간 최소화   

#### 병행 제어 미보장시 문제점
1. 갱신 손실   
먼저 실행된 트랜잭션의 결과를 나중에 실행된 트랜잭션이 덮어쓸 때 발생   
2. 현황 파악오류   
중간 수행 결과를 다른 트랜잭션이 참조하여 발생하는 오류   
3. 모순성   
두 트랜잭션이 동시에 실행되어 DB에서 일관성이 결여되는 오류    
4. 연쇄복귀   
복수의 트랜잭션이 데이터 공유시 특정 트랜잭션이 처리를 취소할 경우 트랜잭션이 처리한 곳의 부분을 취소하지 못하는 오류   

#### 병행 제어 기법의 종류
1. 로킹   
일관성과 무결성을 유지하기 위해 순차적 진행을 보장하는 직렬화 기법   
2. 낙관적 검증   
어떠한 검증도 수행하지 않고 일단 수행 후 종료시 검증을 수행   
3. 타임 스태프 순서   
트랜잭션이 실행을 시작하기 전에 타임 스태프를 부여하여 부여된 시간에 따라 작업을 수행   
4. 다중버전 동시성 제어   
타임스태프를 비교하여 직렬가능성이 보장되는 적절한 버전을 선택하여 접근   

### 데이터베이스 고립화 수준
다른 트랜잭션이 현재의 데이터에 대한 무결성을 해치지 않기 위해 잠금을 설정하는 정도.   

### 회복 기법(Durability의 기법)
트랜잭션을 수행하는 도중 장애로 인해 손상된 DB를 손상되기 이전의 상태로 복구

#### 회복 기법의 종류
1. 로그 기반 회복 기법   
자연 갱신 회복 기법 = 완료되기 전까지 데이터베이스에 기록하지 않는 기법   
즉각 갱신 회복 기법 = 갱신 결과를 바로 DB에 반영하는 기법   
2. 체크 포인트 회복 기법   
장애 발생 시 검사점 이후에 처리된 트랜잭션에 대해서만 장애 발생 이전의 상태로 복원   
3. 그림자 페이징 회복 기법
트랜잭션 수행 시 복제본을 생성하여 DB 장애 시 이를 이용하여 복구   

## DDL(Data Definition Language)
데이터 정의어 = 데이터를 정의하는 언어로 테이블과 같은 데이터 구조를 정의하는데 사용되는 명령어들   

### DDL의 대상
1. 도메인   
하나의 속성이 가질 수 있는 원자 값들의 집합   
2. 스키마   
DB의 구조, 제약조건 등의 정보를 담고 있는 기본적인 구조(외부스키마,개념스키마,내부스키마)    
외부스키마 = 사용자나 개발자의 관점에서 필요로 하는 DB의 논리적 구조   
개념스키마 = DB의 전체적인 논리적 구조, 전체적인 뷰   
내부 스키마 = 물리적 저장장치의 관점에서 보는 DB 구조   
3. 테이블   
데이터 저장 공간   
데이터의 집합체, 릴레이션 혹은 엔터티라고도 불린다.   
4. 뷰   
하나 이상의 물리 테이블에 유도되는 가상의 테이블   
5. 인덱스   
검색을 빠르게 하기 위한 데이터 구조   

### 뷰
논리테이블로서 사용자에게 테이블과 동일하다.   

#### 뷰의 특징
1. 논리적 데이터 독립성 제공   
DB에 영향을 주지 않고 원하는 형태로 데이터에 접근 가능   
2. 데이터 조작 연산 간소화   
원하는 형태의 논리적 구조를 형성하여 데이터 조작 간소화   
3. 보안 기능 제공   
특정 필드만을 선택해서 뷰를 생성할 경우, 선택되지 않은 필드의 조회 및 접근 불가   
4. 뷰 변경 불가   
뷰 정의는 ALTER문을 통해 변경할 수 없다 -> CREATE,DROP만을 사용   

#### 뷰의 장단점
장점   
논리적 독립성 제공, 사용자 데이터 관리 용이, 데이터 보안의 용이   
단점   
뷰 자체 인덱스 불가, 뷰 정의 변경 불가, 데이터 변경 제약 존재   

### 인덱스
데이터를 빠르게 찾을 수 있는 수단으로서, 테이블에 대한 조회 속도를 높여주는 자료 구조이다.   

### DDL 명령어
CREATE, ALTER, DROP, TRUNCATE(DB 오브젝트 내용 삭제)   
ALTER TABLE 테이블명 ADD/DROP 칼럼명 데이터타입[제약조건];   

VIEW 관련 DDL   
CREATE VIEW 뷰이름 AS 조회쿼리;   

INDEX 관련 DDL
CREATE [UNIQUE] INDEX 인덱스명 ON 테이블명(칼럼1,칼럼2);   

### DML(Data Manipulation Language)
DB에 저장된 자료들을 입력,수정,삭제,조회하는 언어   

### DML 명령어
SELECT, INSERT, UPDATE, DELETE    

SELECT 문법 순서도   
SELECT (ALL|DISTINCT)   
FROM   
WHERE   
GROUP BY   
HAVING -> GROUP BY에 의해 분류한 후 그룹에 대한 조건을 지정할 때   
ORDER BY (ASC|DESC) -> 속성값을 정렬   

조인   
두개 이상의 테이블을 연결   
1. 내부조인   
공통 존재 칼럼의 값이 같은 경우 추출   
SELECT 컬럼 FROM 테이블 [INNER]JOIN 테이블 ON 조인조건 [WHERE 검색조건];   
2. 외부조인-왼쪽 외부 조인   
왼쪽 테이블의 모든 데이터와 오른쪽 테이블에서는 동일한 데이터만 추출   
SELECT 컬럼 FROM 테이블 LEFT[OUTER]JOIN 테이블 ON 조인조건 [WHERE 검색조건];   
3. 외부조인-오른쪽 외부 조인   
위와 동일하지만 반대 개념   
SELECT 컬럼 FROM 테이블 RIGHT[OUTER]JOIN 테이블 ON 조인조건 [WHERE 검색조건];   
4. 외부조인-완전 외부 조인   
양쪽 모든 데이터를 추출   
SELECT 컬럼 FROM 테이블 FULL[OUTER]JOIN 테이블 ON 조인조건 [WHERE 검색조건];   
5. 교차 조인   
조인 조건이 없는 모든 데이터 조합을 추출
SELECT 컬럼 FROM 테이블 CROSS JOIN 테이블 -> ON절이 없음   
6. 셀프 조인   
자기 자신에게 별칭을 지정한 후 다시 조인   
SELECT 컬럼 FROM 테이블 [INNER]JOIN 테이블 ON 조인조건 [WHERE 검색조건];   


집합 연산자   
두 테이블 연산에 집합 연산자를 사용   
1. UNION   
중복 행이 제거된 쿼리 결과를 반환   
2. UNION ALL   
중복 행이 제거되지 않은 쿼리 결과를 반환   
3. INTERSECT   
두 쿼리 결과에 공통으로 존재하는 결과를 반환   
4. MINUS   
첫 쿼리에 있고 두번째 쿼리에 없는 결과 반환   

### DCL(Data Control Language)
DB관리자가 데이터 보안, 무결성 유지, 병행 제어, 회복을 위해 사용하는 제어언어  
1. GRANT   
사용 권한 부여
GRANT 권한 ON 테이블 TO 사용자   
2. REVOKE   
사용 권한 취소
REVOKE 권한 ON 테이블 FROM 사용자   
